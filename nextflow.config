
includeConfig 'configs/schedulers.config'

process {
  
    withLabel:process_idx {
        cpus   = { 6 }
        memory = { 30.GB }
    }

    withLabel:process_quant_full {
        cpus   = { 6 }
        memory = { 30.GB }
    }

    withLabel:process_quant_features {
        cpus   = { 4 }
        memory = { 4.GB }
    }

    withLabel:process_parse_exon_intron {
        cpus   = { 1 }
        memory = { 16.GB }
    }

    withLabel:process_mtx {
        cpus   = { 1 }
        memory = { 16.GB }
    }

    withLabel:process_alevinqc {
        cpus   = { 1 }
        memory = { 12.GB }
    }

}

profiles {

    conda {
        process.conda           = "${baseDir}/environment.yml"
        conda.enabled           = true
    }

    docker {
        docker.enabled          = true        
    }

    singularity {
        singularity.enabled     = true
        singularity.autoMounts  = true
    }

    test {

        params.genome        = "$baseDir/test/example_genome.fa.gz"        
        params.gtf           = "$baseDir/test/example_annot.gtf.gz"
        params.quant_args    = '--forceCells 5000'
        params.quant_args_fb = '--forceCells 5000'
        params.samplesheet   = "$baseDir/test/samplesheet.csv"
        params.features_file = "$baseDir/test/hto.tsv"
        params.rrna          = "Mt_rRNA" // just to satisfy the tests
        params.tgmap             = "$baseDir/test/idx_test/annotation.expanded.tx2gene.tsv"
        params.rrnagenes         = "$baseDir/test/idx_test/annotation.rRNA.txt"
        params.mtrnagenes        = "$baseDir/test/idx_test/annotation.mtRNA.txt"
        params.expanded_features = "$baseDir/test/idx_test/annotation.expanded.features.tsv.gz"
        params.gene2type         = "$baseDir/test/idx_test/annotation.gene2type.txt"
        params.translate_list    = "$baseDir/test/translate_list.txt.gz"

        process {

            withLabel:process_idx {
                cpus   = { 1 }
                memory = { 1.GB }
            }

            withLabel:process_quant_full {
                cpus   = { 1 }
                memory = { 1.GB }
            }

            withLabel:process_quant_features {
                cpus   = { 1 }
                memory = { 1.GB }
            }

            withLabel:process_parse_exon_intron {
                cpus   = { 1 }
                memory = { 1.GB }
            }

            withLabel:process_mtx {
                cpus   = { 1 }
                memory = { 1.GB }
            }

            withLabel:process_alevinqc {
                cpus   = { 1 }
                memory = { 1.GB }
            }

        }

    }

}