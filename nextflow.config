
includeConfig 'configs/schedulers.config'

process {
  
    withLabel:process_idx {
        cpus   = { 8 }
        memory = { 50.GB }
    }

    withLabel:process_quant_full {
        cpus   = { 8 }
        memory = { 50.GB }
    }

    withLabel:process_quant_features {
        cpus   = { 8 }
        memory = { 4.GB }
    }

    withLabel:process_parse_exon_intron {
        cpus   = { 1 }
        memory = { 16.GB }
    }

    withLabel:process_mtx {
        cpus   = { 1 }
        memory = { 8.GB }
    }

    withLabel:process_alevinqc {
        cpus   = { 1 }
        memory = { 8.GB }
    }

}

profiles {

    conda {
        process.conda           = "${baseDir}/environment.yml"
        conda.enabled           = true
    }

    docker {
        docker.enabled          = true        
    }

    singularity {
        singularity.enabled     = true
        singularity.autoMounts  = true
    }

    test {

        params.genome        = "$baseDir/test/example_genome.fa.gz"        
        params.gtf           = "$baseDir/test/example_annot.gtf.gz"
        params.quant_args    = '--chromiumV3 --forceCells 5000' // forceCells because the test dataset is so tiny that no knee otherwise can be found!
        params.samplesheet   = "$baseDir/test/samplesheet.csv"
        params.features_file = "$baseDir/test/hto.tsv"
        params.rrna          = "Mt_rRNA" // just to satisfy the tests

        process {

            withLabel:process_idx {
                cpus   = { 1 }
                memory = { 1.GB }
            }

            withLabel:process_quant_full {
                cpus   = { 1 }
                memory = { 1.GB }
            }

            withLabel:process_quant_features {
                cpus   = { 1 }
                memory = { 1.GB }
            }

            withLabel:process_parse_exon_intron {
                cpus   = { 1 }
                memory = { 1.GB }
            }

            withLabel:process_mtx {
                cpus   = { 1 }
                memory = { 1.GB }
            }

            withLabel:process_alevinqc {
                cpus   = { 1 }
                memory = { 1.GB }
            }

        }

    }

}